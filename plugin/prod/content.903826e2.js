var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,s,a,n){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof i[a]&&i[a],l=o.cache||{},h="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,r){if(!l[e]){if(!t[e]){var s="function"==typeof i[a]&&i[a];if(!r&&s)return s(e,!0);if(o)return o(e,!0);if(h&&"string"==typeof e)return h(e);var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}d.resolve=function(r){var s=t[e][1][r];return null!=s?s:r},d.cache={};var u=l[e]=new c.Module(e);t[e][0].call(u.exports,d,u,u.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=o,c.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return i[a]}}),i[a]=c;for(var u=0;u<r.length;u++)c(r[u]);if(s){var d=c(s);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd?e(function(){return d}):n&&(this[n]=d)}}({"68oK5":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"config",()=>i);var a=e("~utils"),n=e("@plasmohq/storage");let i={matches:["https://odin.fun/*"]},o={tokenContainer:".hidden.space-y-5.rounded-lg.bg-black.p-4.lg\\:block",userStats:".relative.flex.w-full.items-center.justify-start.gap-2.md\\:static.md\\:gap-8"};class l{constructor(){this.storage=new n.Storage,this.remarks=[],this.setupStorageWatcher()}setupStorageWatcher(){this.storage.watch({userRemarks:async({newValue:e})=>{try{"string"==typeof e&&(this.remarks=JSON.parse(e||"[]"))}catch(e){console.error("Error parsing updated user remarks:",e)}}})}async load(){try{let e=await this.storage.get("userRemarks");e&&(this.remarks=JSON.parse(e),console.log("Loaded user remarks:",this.remarks))}catch(e){console.error("Error loading user remarks:",e),this.remarks=[]}}async save(){try{await this.storage.set("userRemarks",JSON.stringify(this.remarks)),console.log("Saved user remarks:",this.remarks)}catch(e){console.error("Error saving user remarks:",e)}}async addRemark(e,t,r){let s={userId:e,username:t,remark:r},a=this.remarks.findIndex(t=>t.userId===e);return a>=0?this.remarks[a]=s:this.remarks.push(s),await this.save(),s}getRemark(e){return this.remarks.find(t=>t.userId===e)}async removeRemark(e){let t=this.remarks.findIndex(t=>t.userId===e);return t>=0&&(this.remarks.splice(t,1),await this.save(),!0)}getAllRemarks(){return[...this.remarks]}}class h{constructor(){this.currentInfo={type:null,id:null},this.pageChangeHandlers=[],this._lastUrl=window.location.href,this.extractPageInfo()}getCurrentPage(){return{...this.currentInfo}}extractPageInfo(){let e=window.location.pathname;return e.startsWith("/token/")?this.currentInfo={type:"token",id:e.replace("/token/","")}:e.startsWith("/user/")?this.currentInfo={type:"user",id:e.replace("/user/","")}:this.currentInfo={type:null,id:null},console.log(`Current page: ${this.currentInfo.type}, ID: ${this.currentInfo.id}`),{...this.currentInfo}}setupUrlChangeListener(){let e=history.pushState;history.pushState=(...t)=>{let r=e.apply(history,t);return this.handleUrlChange(),r},window.addEventListener("popstate",()=>{console.log("popstate event, URL changed to",window.location.href),this.handleUrlChange()});let t=new MutationObserver(()=>{window.location.href!==this._lastUrl&&(this._lastUrl=window.location.href,this.handleUrlChange())});t.observe(document,{subtree:!0,childList:!0})}handleUrlChange(){let e=this.extractPageInfo();this.notifyPageChangeHandlers(e)}onPageChange(e){return this.pageChangeHandlers.push(e),e(this.currentInfo),()=>{this.pageChangeHandlers=this.pageChangeHandlers.filter(t=>t!==e)}}notifyPageChangeHandlers(e){this.pageChangeHandlers.forEach(t=>t(e))}}class c{constructor(e){this.currentContainer=null,this.containerObserver=null,this.remarkStorage=e}start(){this.observeBodyForContainer()}extractUsersAndModifyDOM(e){console.log("Processing users in token page");let t=Array.from(e.querySelectorAll("ul li a")).map(e=>({id:e.getAttribute("title"),name:e.textContent?.trim()||"",element:e})).filter(e=>e.id);return t.forEach(({id:e,name:t,element:r})=>{let s=r.closest("span");if(!s||s.getAttribute("data-modified"))return;let a=this.remarkStorage.getRemark(e);if(a&&a.remark){r.innerHTML="";let e=document.createTextNode(a.remark);r.style.color="#FFD700",r.style.fontWeight="bold",r.appendChild(e)}s.setAttribute("data-modified","true")}),t}observeContainer(e){this.containerObserver&&this.containerObserver.disconnect(),console.log("Observing new container:",e),this.extractUsersAndModifyDOM(e),this.containerObserver=new MutationObserver(()=>{console.log("Container content changed, updating user list..."),this.extractUsersAndModifyDOM(e)}),this.containerObserver.observe(e,{childList:!0,subtree:!0})}observeBodyForContainer(){let e=new MutationObserver(()=>{let e=document.querySelectorAll(o.tokenContainer);if(2===e.length){let t=e[1];t!==this.currentContainer&&(console.log("Container updated, switching observer..."),this.currentContainer=t,this.currentContainer&&this.observeContainer(this.currentContainer))}});e.observe(document.body,{childList:!0,subtree:!0})}stop(){this.containerObserver&&(this.containerObserver.disconnect(),this.containerObserver=null)}}class u{constructor(e){this.bodyObserver=null,this.currentUserId=null,this.remarkStorage=e}start(e){this.currentUserId=e,this.observeUserPage()}createButton(e,t){let r=document.createElement("button");return r.className="inline-flex items-center text-sm justify-center gap-2 whitespace-nowrap rounded-md transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 text-secondary-foreground shadow-sm px-3 py-2 bg-odin-blue font-bold hover:bg-odin-blue/80 h-8",r.textContent=e,r.addEventListener("click",t),r}addButtonToUserPage(){if(!this.currentUserId)return;let e=document.querySelector(o.userStats);if(!e)return;let t=e.querySelector("span.line-clamp-1");if(!t||t.parentElement?.querySelector('[data-custom-button="true"]'))return;let r=t.textContent?.trim()||"\u672a\u77e5\u7528\u6237",s=this.remarkStorage.getRemark(this.currentUserId),n=t.parentElement?.querySelector(".user-remark-display");n&&n.remove();let i=s?"\u4fee\u6539\u5907\u6ce8":"\u6dfb\u52a0\u5907\u6ce8";s&&(i=`${s.remark}`);let l=this.createButton(i,()=>{(0,a.logMessage)({action:"add_remark",userId:this.currentUserId});let e=prompt("\u8bf7\u8f93\u5165\u5907\u6ce8:",s?.remark||"");e.trim()&&this.remarkStorage.addRemark(this.currentUserId||"",r,e).then(()=>{l.textContent=`${e}`,l.style.backgroundColor="#2c3349",l.style.color="#ffffff"})});l.setAttribute("data-custom-button","true"),l.style.marginLeft="8px",s&&(l.style.backgroundColor="#2c3349",l.style.color="#ffffff"),t.parentElement?.insertBefore(l,t.nextSibling)}observeUserPage(){this.bodyObserver&&this.bodyObserver.disconnect(),this.bodyObserver=new MutationObserver(()=>{this.addButtonToUserPage()}),this.bodyObserver.observe(document.body,{childList:!0,subtree:!0}),this.addButtonToUserPage()}stop(){this.bodyObserver&&(this.bodyObserver.disconnect(),this.bodyObserver=null)}}let d=new class{constructor(){this.remarkStorage=new l,this.pageRouter=new h,this.currentHandler=null,this.tokenPageHandler=new c(this.remarkStorage),this.userPageHandler=new u(this.remarkStorage)}async init(){"complete"!==document.readyState&&await new Promise(e=>window.addEventListener("load",e,{once:!0})),console.log("Document loaded, starting application..."),await this.remarkStorage.load(),this.pageRouter.setupUrlChangeListener(),this.pageRouter.onPageChange(e=>this.handlePageChange(e))}handlePageChange(e){this.currentHandler&&(this.currentHandler.stop(),this.currentHandler=null),"token"===e.type?(this.tokenPageHandler.start(),this.currentHandler=this.tokenPageHandler):"user"===e.type&&(this.userPageHandler.start(e.id),this.currentHandler=this.userPageHandler)}};d.init()},{"~utils":"5a0s7","@plasmohq/storage":"25Hq9","@parcel/transformer-js/src/esmodule-helpers.js":"fRZO2"}],"5a0s7":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"waittingBetween",()=>i),s.export(r,"logMessage",()=>o);var a=e("@plasmohq/storage");let n=new a.Storage,i=(e,t)=>new Promise(r=>setTimeout(r,Math.floor(Math.random()*(t-e))+e)),o=async e=>{let t=await n.get("logs")||[];t.push(JSON.stringify({time:new Date().toISOString(),...e})),await n.set("logs",t)}},{"@plasmohq/storage":"25Hq9","@parcel/transformer-js/src/esmodule-helpers.js":"fRZO2"}],"25Hq9":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"BaseStorage",()=>o),s.export(r,"Storage",()=>l);var a=e("pify"),n=s.interopDefault(a),i=()=>{try{let e=globalThis.navigator?.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===e[1])return 100>parseInt(e[2])||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{}return!1},o=class{#e;#t;get primaryClient(){return this.#t}#r;get secondaryClient(){return this.#r}#s;get area(){return this.#s}get hasWebApi(){try{return"u">typeof window&&!!window.localStorage}catch(e){return console.error(e),!1}}#a=new Map;#n;get copiedKeySet(){return this.#n}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#i=!1;get allCopied(){return this.#i}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);serde={serializer:JSON.stringify,deserializer:JSON.parse};constructor({area:e="sync",allCopied:t=!1,copiedKeyList:r=[],serde:s={}}={}){this.setCopiedKeySet(r),this.#s=e,this.#i=t,this.serde={...this.serde,...s};try{this.hasWebApi&&(t||r.length>0)&&(this.#r=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),i()?this.#t=(0,n.default)(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#n=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>Object.entries(await this.rawGetAll()).filter(([e])=>this.isValidKey(e)).reduce((e,[t,r])=>(e[this.getUnnamespacedKey(t)]=r,e),{});copy=async e=>{let t=void 0===e;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let r=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!r)return!1;let s=!1;for(let e in r){let t=r[e],a=this.#r?.getItem(e);this.#r?.setItem(e,t),s||=t!==a}return s};rawGet=async e=>(await this.rawGetMany([e]))[e];rawGetMany=async e=>this.hasExtensionApi?await this.#t.get(e):e.filter(this.isCopied).reduce((e,t)=>(e[t]=this.#r?.getItem(t),e),{});rawSet=async(e,t)=>await this.rawSetMany({[e]:t});rawSetMany=async e=>(this.#r&&Object.entries(e).filter(([e])=>this.isCopied(e)).forEach(([e,t])=>this.#r.setItem(e,t)),this.hasExtensionApi&&await this.#t.set(e),null);clear=async(e=!1)=>{e&&this.#r?.clear(),await this.#t.clear()};rawRemove=async e=>{await this.rawRemoveMany([e])};rawRemoveMany=async e=>{this.#r&&e.filter(this.isCopied).forEach(e=>this.#r.removeItem(e)),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=Object.keys(await this.getAll());await this.removeMany(e)};watch=e=>{let t=this.isWatchSupported();return t&&this.#o(e),t};#o=e=>{for(let t in e){let r=this.getNamespacedKey(t),s=this.#a.get(r)?.callbackSet||new Set;if(s.add(e[t]),s.size>1)continue;let a=(e,t)=>{if(t!==this.area||!e[r])return;let s=this.#a.get(r);if(!s)throw Error(`Storage comms does not exist for nsKey: ${r}`);Promise.all([this.parseValue(e[r].newValue),this.parseValue(e[r].oldValue)]).then(([e,r])=>{for(let a of s.callbackSet)a({newValue:e,oldValue:r},t)})};this.#e.onChanged.addListener(a),this.#a.set(r,{callbackSet:s,listener:a})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let r=this.getNamespacedKey(t),s=e[t],a=this.#a.get(r);a&&(a.callbackSet.delete(s),0===a.callbackSet.size&&(this.#a.delete(r),this.#e.onChanged.removeListener(a.listener)))}}unwatchAll=()=>this.#h();#h(){this.#a.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#a.clear()}async getItem(e){return this.get(e)}async getItems(e){return await this.getMany(e)}async setItem(e,t){await this.set(e,t)}async setItems(e){await await this.setMany(e)}async removeItem(e){return this.remove(e)}async removeItems(e){return await this.removeMany(e)}},l=class extends o{get=async e=>{let t=this.getNamespacedKey(e),r=await this.rawGet(t);return this.parseValue(r)};getMany=async e=>{let t=e.map(this.getNamespacedKey),r=await this.rawGetMany(t),s=await Promise.all(Object.values(r).map(this.parseValue));return Object.keys(r).reduce((e,t,r)=>(e[this.getUnnamespacedKey(t)]=s[r],e),{})};set=async(e,t)=>{let r=this.getNamespacedKey(e),s=this.serde.serializer(t);return this.rawSet(r,s)};setMany=async e=>{let t=Object.entries(e).reduce((e,[t,r])=>(e[this.getNamespacedKey(t)]=this.serde.serializer(r),e),{});return await this.rawSetMany(t)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};removeMany=async e=>{let t=e.map(this.getNamespacedKey);return await this.rawRemoveMany(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(void 0!==e)return this.serde.deserializer(e)}catch(e){console.error(e)}}}},{pify:"fS8wt","@parcel/transformer-js/src/esmodule-helpers.js":"fRZO2"}],fS8wt:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>i);let a=(e,t,r,s)=>function(...a){let n=t.promiseModule;return new n((n,i)=>{t.multiArgs?a.push((...e)=>{t.errorFirst?e[0]?i(e):(e.shift(),n(e)):n(e)}):t.errorFirst?a.push((e,t)=>{e?i(e):n(t)}):a.push(n),Reflect.apply(e,this===r?s:this,a)})},n=new WeakMap;function i(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};let r=typeof e;if(!(null!==e&&("object"===r||"function"===r)))throw TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${null===e?"null":r}\``);let s=(e,r)=>{let s=n.get(e);if(s||(s={},n.set(e,s)),r in s)return s[r];let a=e=>"string"==typeof e||"symbol"==typeof r?r===e:e.test(r),i=Reflect.getOwnPropertyDescriptor(e,r),o=void 0===i||i.writable||i.configurable,l=t.include?t.include.some(e=>a(e)):!t.exclude.some(e=>a(e)),h=l&&o;return s[r]=h,h},i=new WeakMap,o=new Proxy(e,{apply(e,r,s){let n=i.get(e);if(n)return Reflect.apply(n,r,s);let l=t.excludeMain?e:a(e,t,o,e);return i.set(e,l),Reflect.apply(l,r,s)},get(e,r){let n=e[r];if(!s(e,r)||n===Function.prototype[r])return n;let l=i.get(n);if(l)return l;if("function"==typeof n){let r=a(n,t,o,e);return i.set(n,r),r}return n}});return o}},{"@parcel/transformer-js/src/esmodule-helpers.js":"fRZO2"}],fRZO2:[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}]},["68oK5"],"68oK5","parcelRequireff16"),globalThis.define=t;